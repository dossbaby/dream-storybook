# Dream Storybook 구현 전략
## 태그 시스템 + pSEO + 결제 통합 마스터 플랜

> 최종 업데이트: 2024년 12월

---

## 핵심 철학: Pieter Levels식 pSEO

### 원칙
1. **모든 페이지는 유용해야 한다** - 빈 페이지, 의미없는 페이지 금지
2. **검색 의도(Search Intent)를 만족시켜야 한다** - 사용자가 원하는 정보 제공
3. **Win-Win 구조** - 사용자는 가치를 얻고, 플랫폼은 트래픽을 얻는다
4. **데이터 → 페이지 자동화** - 모든 유의미한 데이터가 검색 가능한 페이지가 된다

### 우리 서비스에 적용
```
RemoteOK 방식              →  Dream Storybook 적용
─────────────────────────────────────────────────────
회사별 채용 페이지          →  태그별 콘텐츠 페이지 (/tag/뱀)
구직자 프로필 페이지        →  사용자 공개 프로필 (/user/{id})
직업 카테고리 페이지        →  콘텐츠 타입 페이지 (/dreams, /tarots, /saju)
도시별 페이지 (NomadList)   →  카테고리별 페이지 (/dreams/category/animal)
```

---

## 1. 통합 태그/카테고리 시스템 (Master Architecture)

### 문제점: 현재 분산된 시스템
```
현재 (복잡하고 비효율적):
├── 꿈: keywords[], dreamType, DREAM_CATEGORIES
├── 타로: keywords[], topic, TAROT_CATEGORIES
├── 사주: keywords[], FORTUNE_CATEGORIES
└── 각각 따로 놀고, 연결 안 됨
```

### 해결: 통합 태그 시스템
```
새로운 구조 (심플하고 유기적):
├── 모든 콘텐츠 → tags[] 배열로 통일
├── 태그 = 카테고리 = 상징 = 키워드 (모두 하나의 시스템)
└── 타입(dream/tarot/saju)으로만 구분
```

### Firebase 구조

```javascript
// 콘텐츠 저장 구조 (통일)
dreams/{id} | tarots/{id} | sajus/{id}
{
  // 기본 정보
  type: "dream" | "tarot" | "saju",
  title: "뱀에게 쫓기는 꿈",

  // 통합 태그 시스템 (핵심!)
  tags: ["뱀", "공포", "도망", "변화", "동물"],
  primaryTag: "뱀",  // 대표 태그 (SEO용)

  // 공개 설정 (통일)
  visibility: "private" | "unlisted" | "public",
  isAnonymous: false,  // 공개 시 익명 여부

  // 메타
  userId: "xxx",
  userName: "꿈꾸는자" | "익명",
  createdAt: Timestamp,

  // ... 기존 콘텐츠 데이터
}

// 태그 집계 컬렉션
tags/{tagName}
{
  name: "뱀",
  slug: "snake",  // URL용

  // 타입별 카운트
  totalCount: 234,
  dreamCount: 156,
  tarotCount: 67,
  sajuCount: 11,

  // SEO 메타데이터
  seoTitle: "뱀 꿈해몽 - 뱀 꿈 의미와 해석",
  seoDescription: "뱀이 나오는 꿈의 의미를 알아보세요...",

  // 관련 태그 (자동 집계)
  relatedTags: ["동물", "공포", "변화", "재물"],

  // 통계
  weeklyCount: 23,  // 트렌딩 계산용
  updatedAt: Timestamp
}
```

### 태그 자동 분류 체계

```javascript
// 태그 카테고리 (내부 관리용, 사용자에겐 보이지 않음)
const TAG_HIERARCHY = {
  // 꿈 중심 태그
  animals: ["뱀", "호랑이", "개", "고양이", "용", "물고기", "새"],
  nature: ["물", "불", "바다", "산", "하늘", "비", "눈"],
  people: ["가족", "엄마", "아빠", "친구", "연인", "돌아가신분"],
  actions: ["날다", "떨어지다", "쫓기다", "죽다", "울다"],
  places: ["집", "학교", "회사", "병원", "엘리베이터"],
  emotions: ["무서운", "행복한", "슬픈", "불안한"],

  // 타로/사주 중심 태그
  topics: ["연애", "직장", "재물", "건강", "학업", "인간관계"],
  timing: ["오늘", "이번주", "이번달", "올해"],

  // 공통 상징
  symbols: ["변화", "시작", "끝", "기회", "위험", "성공", "실패"]
};
```

---

## 2. URL 구조 및 pSEO 페이지

### 라우팅 맵

```
메인 페이지
/                                 → 앱 메인

태그 시스템 (핵심 pSEO)
/tag/{tagName}                    → 통합 태그 페이지
/tag/{tagName}?type=dream         → 꿈만 필터
/tag/{tagName}?type=tarot         → 타로만 필터
/tag/{tagName}?type=saju          → 사주만 필터
/tags                             → 전체 태그 탐색 (인기순)
/tags/trending                    → 트렌딩 태그

콘텐츠 타입별 목록 (pSEO)
/dreams                           → 꿈해몽 전체
/dreams/category/{category}       → 동물꿈, 자연꿈 등
/tarots                           → 타로 전체
/tarots/category/{category}       → 연애타로, 직장타로 등
/saju                             → 사주 전체
/saju/category/{category}         → 카테고리별

개별 콘텐츠 (pSEO)
/dream/{id}                       → 개별 꿈 페이지
/tarot/{id}                       → 개별 타로 페이지
/saju/{id}                        → 개별 사주 페이지

사용자 프로필 (pSEO)
/user/{userId}                    → 공개 프로필 (공개 콘텐츠만)
```

### 페이지별 SEO 전략

```
/tag/뱀 페이지 예시:
─────────────────────
Title: 뱀 꿈해몽 & 타로 - 뱀의 의미와 해석 | 꿈 스토리북
Description: 뱀이 나오는 꿈의 의미, 뱀 관련 타로 리딩을 확인하세요.
            156개의 뱀 꿈 해석과 67개의 타로 리딩이 있습니다.
H1: #뱀 - 꿈과 타로에서의 의미
Keywords: 뱀꿈, 뱀꿈해몽, 뱀나오는꿈, 뱀타로, 뱀의미

Structured Data (JSON-LD):
{
  "@type": "CollectionPage",
  "name": "뱀 관련 꿈해몽 & 타로",
  "description": "...",
  "numberOfItems": 234
}
```

---

## 3. 공개 설정 시스템 (통합)

### 3단계 공개 설정

```
┌─────────────────────────────────────────────────────────────┐
│  저장 시 공개 설정 (모든 콘텐츠 동일)                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  🔒 나만 보기 (기본값)                                │   │
│  │                                                      │   │
│  │  • 내 마이페이지에서만 보임                           │   │
│  │  • 검색/태그 페이지에 노출 안됨                       │   │
│  │  • pSEO 대상 아님                                    │   │
│  │  • 링크 공유 불가                                    │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  🔗 링크 공유 가능 (Unlisted)                         │   │
│  │                                                      │   │
│  │  • 링크 아는 사람만 접근 가능                         │   │
│  │  • 검색/태그 페이지에 노출 안됨                       │   │
│  │  • pSEO 대상 아님 (noindex)                          │   │
│  │  • 카카오톡 등 공유 가능                              │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  🌐 커뮤니티에 공개                                   │   │
│  │                                                      │   │
│  │  • 피드에 노출                                       │   │
│  │  • 태그 페이지에 노출                                 │   │
│  │  • 검색엔진 크롤링 대상 (pSEO)                        │   │
│  │  • ☑️ 익명으로 공개 (선택)                            │   │
│  │       → 작성자: "익명의 꿈꾸는 자"                    │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 공개 설정 UI 컴포넌트

```jsx
// 저장 모달에 통합
<VisibilitySelector
  value={visibility}
  onChange={setVisibility}
  options={[
    {
      value: 'private',
      icon: '🔒',
      label: '나만 보기',
      description: '내 마이페이지에서만 확인'
    },
    {
      value: 'unlisted',
      icon: '🔗',
      label: '링크로 공유',
      description: '링크 아는 사람만 볼 수 있음'
    },
    {
      value: 'public',
      icon: '🌐',
      label: '커뮤니티에 공개',
      description: '모든 사람이 볼 수 있음',
      extra: (
        <label>
          <input type="checkbox" /> 익명으로 공개
        </label>
      )
    }
  ]}
/>
```

---

## 4. 결제 시스템 전략

### 가격 구조

```
┌─────────────────────────────────────────────────────────────┐
│  수익화 모델                                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  무료 (Free)                                                │
│  ──────────                                                 │
│  • 꿈해몽: 하루 2회                                          │
│  • 타로: 하루 1회                                            │
│  • 사주: 3일에 1회                                           │
│  • 기본 분석만 (짧은 버전, 3-4문장)                           │
│  • hiddenInsight 잠금 (블러 처리)                            │
│  • 이미지 저화질                                             │
│  • 광고 표시                                                 │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  프리미엄 (Premium)                                          │
│  ─────────────────                                          │
│  월간: ₩6,900/월                                            │
│  연간: ₩49,000/년 (월 ₩4,083, 40% 할인)                     │
│                                                             │
│  • 무제한 리딩                                               │
│  • 심층 분석 전체 (긴 버전 + hiddenInsight)                   │
│  • 이미지 고화질                                             │
│  • 광고 완전 제거                                            │
│  • 프리미엄 전용 테마                                        │
│  • 리딩 히스토리 무제한 저장                                  │
│  • 우선 고객 지원                                            │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  1회권 (One-time)                                           │
│  ─────────────────                                          │
│  ₩1,900/회                                                  │
│                                                             │
│  • 구독 없이 1회 심층 분석                                    │
│  • hiddenInsight 포함                                        │
│  • 고화질 이미지                                             │
│  • 해당 리딩만 광고 제거                                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 가격 전략 이유

```
1회권 ₩1,900 설정 이유:
───────────────────────
• 월 구독 ₩6,900 대비 "3.6회면 구독이 이득" → 구독 유도
• 심리적 가격대: ₩1,000대는 "커피 한 잔"으로 인식
• ₩500은 너무 싸서 가치 인식 낮음
• ₩1,900 × 4회 = ₩7,600 > 월 ₩6,900 → 4회 이상 쓸 것 같으면 구독
• 한 달에 3-4회 쓰는 라이트 유저도 수익화 가능

연간 구독 ₩49,000 설정 이유:
───────────────────────────
• 월 ₩6,900 × 12 = ₩82,800
• 연간 ₩49,000 = 40% 할인
• ₩49,000 ÷ 12 = 월 ₩4,083
• 심리적 가격대: "5만원 미만" → 결제 허들 낮음
• 연간 결제 시 이탈률 낮음 (Commitment)
```

### 무료 vs 프리미엄 비교 모달

```
┌─────────────────────────────────────────────────────────────┐
│                    ✨ 프리미엄으로 업그레이드                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  지금 보고 계신 리딩의 숨겨진 인사이트가 있어요               │
│                                                             │
│  ┌─────────────────────┬─────────────────────┐              │
│  │      무료 버전       │    프리미엄 버전     │              │
│  ├─────────────────────┼─────────────────────┤              │
│  │                     │                     │              │
│  │  기본 분석 3-4문장   │  심층 분석 15문장+   │              │
│  │  ──────────────     │  ──────────────     │              │
│  │  "좋은 기운이        │  "이 꿈은 단순히     │              │
│  │   있습니다..."       │   뱀을 보신 게       │              │
│  │                     │   아니에요. 지금     │              │
│  │                     │   민지님 주변에      │              │
│  │                     │   숨기는 사람이      │              │
│  │                     │   있어요. 이번 달    │              │
│  │                     │   안에 그 사람이     │              │
│  │                     │   정체를 드러낼      │              │
│  │                     │   거예요..."         │              │
│  │                     │                     │              │
│  ├─────────────────────┼─────────────────────┤              │
│  │  ❌ Hidden Insight   │  ✅ Hidden Insight   │              │
│  │     (잠금)           │     (전체 공개)      │              │
│  ├─────────────────────┼─────────────────────┤              │
│  │  📷 저화질 이미지    │  📷 고화질 이미지    │              │
│  ├─────────────────────┼─────────────────────┤              │
│  │  📺 광고 있음        │  ✅ 광고 없음        │              │
│  ├─────────────────────┼─────────────────────┤              │
│  │  하루 2회 제한       │  무제한              │              │
│  └─────────────────────┴─────────────────────┘              │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  🔥 연간 구독 시 40% 할인!                           │   │
│  │     월 ₩6,900 → 월 ₩4,083 (연 ₩49,000)              │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐   │
│  │ 이번만 ₩1,900 │  │ 월 ₩6,900    │  │ 연 ₩49,000   │   │
│  │   1회권       │  │   구독하기    │  │   Best Deal!  │   │
│  └───────────────┘  └───────────────┘  └───────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### No-Brainer 포인트

```
사용자 심리 흐름:
─────────────────
1. 무료로 리딩 받음 → "오 재밌다"
2. Hidden Insight 블러 처리 → "뭔데? 궁금해"
3. 블러 클릭 → 프리미엄 모달 팝업
4. 비교표 봄 → "차이가 확실하네"
5. 가격 봄 → "1,900원이면 커피값인데..."
6. 결제 → 심층 분석 봄 → "와 이건 돈값 한다"
7. 다음에도 씀 → "매번 1,900원이면... 구독이 낫겠다"
8. 월 구독 → 계속 사용 → "연간이 더 싸네" → 연간 전환
```

---

## 5. pSEO 최적화 전략 (Pieter Levels 방식)

### 페이지 생성 원칙

```
✅ 생성해야 하는 페이지 (유용함):
───────────────────────────────
• /tag/뱀 - 뱀 관련 꿈/타로 모음 (검색 의도: "뱀꿈 해몽")
• /dream/{id} - 개별 꿈 상세 (검색 의도: 비슷한 꿈 찾기)
• /dreams/category/animal - 동물 꿈 모음
• /user/{id} - 공개 프로필 (검색 의도: 해몽가 찾기)

❌ 생성하면 안 되는 페이지 (무가치):
────────────────────────────────
• 콘텐츠 없는 태그 페이지 (0개)
• 너무 구체적인 조합 (/tag/뱀?type=saju&year=2024)
• 중복 콘텐츠 페이지
• 자동 생성된 의미없는 페이지
```

### 태그 페이지 최소 기준

```javascript
// 태그 페이지 생성 조건
const shouldCreateTagPage = (tag) => {
  return (
    tag.totalCount >= 3 &&  // 최소 3개 콘텐츠
    tag.name.length >= 2 && // 한 글자 태그 제외
    !BLOCKED_TAGS.includes(tag.name) // 부적절한 태그 제외
  );
};
```

### SEO 자동화 파이프라인

```
콘텐츠 저장 → 태그 추출 → 태그 카운트 업데이트 → 페이지 자동 생성
     ↓              ↓              ↓                   ↓
  Firebase      정규화         tags 컬렉션        sitemap 갱신
```

### Sitemap 전략

```xml
<!-- sitemap-tags.xml (동적 생성) -->
<urlset>
  <!-- 인기 태그만 포함 (count >= 10) -->
  <url>
    <loc>https://dreamstorybook.com/tag/뱀</loc>
    <lastmod>2024-12-06</lastmod>
    <changefreq>daily</changefreq>
    <priority>0.8</priority>
  </url>
  <!-- ... -->
</urlset>

<!-- sitemap-content.xml (동적 생성) -->
<urlset>
  <!-- 공개 콘텐츠만 포함 -->
  <url>
    <loc>https://dreamstorybook.com/dream/abc123</loc>
    <lastmod>2024-12-05</lastmod>
    <priority>0.6</priority>
  </url>
  <!-- ... -->
</urlset>
```

### 내부 링크 구조

```
모든 페이지에서 상호 연결:
──────────────────────────
개별 콘텐츠 → 관련 태그들 (클릭 가능)
태그 페이지 → 개별 콘텐츠들
태그 페이지 → 관련 태그들
카테고리 페이지 → 해당 태그들
사용자 프로필 → 해당 사용자 콘텐츠

→ 크롤러가 모든 페이지를 쉽게 발견
→ 페이지 간 링크 주스(Link Juice) 분배
```

---

## 6. 구현 우선순위 (Phase별)

### Phase 1: 기반 작업 (1-2일)
```
[P1-1] 타로 결과창 하단 뒤로가기/다른질문 버튼 제거
[P1-2] 명조 폰트 → 리디바탕 전체 변경
[P1-3] fortunes → saju 네이밍 전체 변경 (라우팅, 컬렉션명)
```

### Phase 2: 통합 공개 설정 (2-3일)
```
[P2-1] visibility 필드 통일 (dream/tarot/saju 모두)
[P2-2] 저장 시 공개 설정 UI 컴포넌트 생성
[P2-3] 마이페이지 공개 설정 통합
[P2-4] unlisted 모드 구현 (링크 공유용)
```

### Phase 3: 태그 시스템 (3-5일)
```
[P3-1] 저장 시 keywords → tags 정규화 로직
[P3-2] tags 컬렉션 생성 및 카운트 관리
[P3-3] 키워드 클릭 → /tag/{tagName} 라우팅
[P3-4] TagPage.jsx 생성 (통합 태그 페이지)
[P3-5] 타입별 필터 탭 구현
[P3-6] 관련 태그 표시
```

### Phase 4: pSEO 강화 (2-3일)
```
[P4-1] TagPage SEO 메타데이터 자동 생성
[P4-2] /tags 전체 태그 탐색 페이지
[P4-3] 트렌딩 태그 로직
[P4-4] sitemap 동적 생성 (태그 + 콘텐츠)
[P4-5] robots.txt 최적화
```

### Phase 5: 결제 시스템 (5-7일)
```
[P5-1] 무료/프리미엄 기능 분리 정의
[P5-2] 무료 횟수 제한 로직 구현
[P5-3] Hidden Insight 블러 처리
[P5-4] 프리미엄 비교 모달 UI
[P5-5] 결제 연동 (토스페이먼츠/Stripe)
[P5-6] 구독 상태 관리 (Firebase)
[P5-7] 1회권 구매 로직
```

### Phase 6: 최적화 (2-3일)
```
[P6-1] 광고 시스템 연동 (무료 사용자)
[P6-2] 이미지 품질 분기 (무료/프리미엄)
[P6-3] 분석 길이 분기 (무료/프리미엄)
[P6-4] A/B 테스트 설정
```

---

## 7. 기술 스택 요약

```
Frontend:
├── React + Vite
├── React Router (pSEO 라우팅)
├── react-helmet-async (SEO 메타)
└── CSS Modules

Backend:
├── Firebase Firestore (데이터)
├── Firebase Auth (인증)
├── Firebase Functions (서버리스)
└── Claude API (AI 분석)

결제:
├── 토스페이먼츠 or Stripe
└── Firebase Functions (웹훅 처리)

SEO:
├── 동적 sitemap 생성
├── JSON-LD Structured Data
├── Open Graph 메타태그
└── robots.txt
```

---

## 8. 성공 지표 (KPIs)

```
pSEO 지표:
├── 인덱싱된 페이지 수
├── 오가닉 트래픽
├── 태그 페이지 클릭률
└── 검색 순위 (주요 키워드)

비즈니스 지표:
├── 무료→프리미엄 전환율
├── 1회권 구매 횟수
├── 월간 반복 수익 (MRR)
├── 연간 구독 비율
└── 이탈률 (Churn Rate)

사용자 지표:
├── DAU/MAU
├── 리딩 완료율
├── 공개 설정 비율
├── 태그 클릭률
└── 공유율
```

---

## 부록: 마이그레이션 체크리스트

```
[ ] fortunes 컬렉션 → saju 컬렉션 마이그레이션
[ ] 기존 keywords → tags 변환 스크립트
[ ] isPublic → visibility 마이그레이션
[ ] 기존 라우팅 리다이렉트 설정 (/fortune/* → /saju/*)
[ ] SEO 메타데이터 업데이트
[ ] sitemap 재생성
```
